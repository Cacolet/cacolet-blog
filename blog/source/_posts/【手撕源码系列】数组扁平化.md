---
title: 【手撕源码系列】数组扁平化
date: 2021-11-04 9:01:18
tags:
    - JavaScript
categories:
    - 手撕源码
keywords: "面试,js基础"
description: 
cover: https://img.cdn.sugarat.top/mdImg/MTY0NjcwNDYzODcwMA==646704638700


---

# 数组扁平化

数组的扁平化就是将一个嵌套多层的数组 array (嵌套可以是任何层数)转换为只有一层的数组

举个例子，假设有个名为 flatten 的函数可以做到数组扁平化，效果就会如下

```js
let arr = [1, [2, [3, 4]]];
console.log(flatten(arr)) // [1, 2, 3, 4]
```

第一次看到这个题，能想到的就是循环遍历数组元素，如果还是一个数组就递归调用该方法

```js
let arr = [1,[2,[3,4]]]

function flatten(arr){
    let res = []
    // 利用闭包将值保存起来传下去
    let fn = function (arr) {
        arr.forEach((item)=>{
            if(typeof item === "number"){
                res.push(item)
            }
            else{ 
                fn(item)
            }
        })
    }
    fn(arr)
    return res
}
```

但是上面这 样在里面多创建一个函数有点儿多于，所以改进一下

```js
function flatten(arr) {
    let res = []
    arr.forEach((item) =>{
        if(typeof item == "number"){
            res.push(item)
        }
        else{
            res = res.concat(flatten(item))
        }
    })
    return res
}

```

这样的话就是自身调用自己

## toString

如果数组的元素是数字，那么可以使用`toString`这个方法

```js
let arr = [1,[2,[3,4]]]
arr.toString().split(',').map((item)=>{
    return Number(item) // +item
})
```

## reduce

既然是对数组的处理，最终就是返回一个值，我们可以考虑使用reduce来简化代码

```js
let arr = [1,[2,[3,4]]]

function flatten(arr){
    return arr.reduce((prev,next)=>{
        return prev.concat(Array.isArray(next) ? flatten(next) : next)
    },[])
}
console.log(flatten(arr)) // [1,2,3,4]
```

## 扩展运算符(...)

```js
let arr = [1,[2,[3,4]]]

function flatten(arr){
    // 但是这里的时间复杂度有点儿高 不推荐
    while(arr.some((item) => Array.isArray(arr))){
        arr = [].concat(...arr)
    }
    return arr
}
```

当然，正真的扁平化有个扁平化的层数的参数

```js
let arr = [1,[2,[3,4]]]

arr.flat(1) // [1,2,[3,4]]
```

那我们手写的如何实现扁平化的层数控制？

我们可以直接加一手次数控制就可以解决掉

```js
let arr = [1,[2,[3,[4,5]]]]

function flatten(arr,count) {
    let res = []
    let x = count // 控制扁平化层数
    arr.forEach((item)=>{
        console.log(item)
        if(typeof item === "number" || x === 0){
            res.push(item)
        }
        else {
            x--
            res = res.concat(flatten(item,x))
        }
    })

    return res
}
```

当然实现的方法很多，重要的是我们如何去把一个数组的元素转化到一个数组里面去？思路弄清晰，实现就相对来说比较简单了，基本思路递归，把是数组放在里面再去递归，可以用作用域链将最外层的res直接在内部函数中使用，也可以设置返回值用concat合并返回值。